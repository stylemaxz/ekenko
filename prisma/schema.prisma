generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Employee {
  id                  String         @id @default(uuid())
  name                String
  email               String         @unique
  phone               String
  role                Role
  avatar              String?
  portfolioSize       Int            @default(0)
  username            String?        @unique
  password            String?
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt
  assignedLocationIds String[]
  activityLogs        ActivityLog[]
  leaveRequests       LeaveRequest[]
  tasks               Task[]
  visits              Visit[]
}

model Company {
  id        String        @id @default(uuid())
  name      String
  taxId     String?
  logo      String?
  grade     CompanyGrade
  status    CompanyStatus
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  locations Location[]
  tasks     Task[]
}

model Location {
  id                  String          @id @default(uuid())
  companyId           String
  code                String?
  status              LocationStatus?
  name                String
  address             String
  postalCode          String?
  district            String?
  province            String?
  region              String?
  googleMapLink       String?
  lat                 Float
  lng                 Float
  officialName        String?
  customerType        CustomerType?
  ownerName           String?
  ownerPhone          String?
  documents           String[]
  shippingAddress     String?
  receiverName        String?
  receiverPhone       String?
  creditTerm          Int?
  vatType             VatType?
  promotionNotes      String?
  notes               String?
  statusNote          String?
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt
  createdBy           String?
  assignedEmployeeIds String[]
  contacts            ContactPerson[]
  company             Company         @relation(fields: [companyId], references: [id])
  tasks               Task[]
  visits              Visit[]
}

model ContactPerson {
  id         String   @id @default(uuid())
  locationId String
  name       String
  role       String
  phone      String
  lineId     String?
  location   Location @relation(fields: [locationId], references: [id], onDelete: Cascade)
}

model Visit {
  id           String    @id @default(uuid())
  employeeId   String
  locationId   String
  checkInTime  DateTime
  checkOutTime DateTime?
  objectives   String[]
  notes        String?
  images       String[]
  metOwner     Boolean   @default(false)
  createdAt    DateTime  @default(now())
  employee     Employee  @relation(fields: [employeeId], references: [id])
  location     Location  @relation(fields: [locationId], references: [id])
}

model Task {
  id             String       @id @default(uuid())
  title          String
  description    String?
  objectives     String[]
  assigneeId     String
  customerId     String?
  locationId     String?
  dueDate        DateTime
  priority       TaskPriority
  status         TaskStatus
  completionNote String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  assignee       Employee     @relation(fields: [assigneeId], references: [id])
  company        Company?     @relation(fields: [customerId], references: [id])
  location       Location?    @relation(fields: [locationId], references: [id])
}

model LeaveRequest {
  id         String      @id @default(uuid())
  employeeId String
  type       LeaveType
  startDate  DateTime
  endDate    DateTime
  days       Float
  reason     String
  status     LeaveStatus
  reviewNote String?
  reviewedBy String?
  reviewedAt DateTime?
  createdAt  DateTime    @default(now())
  employee   Employee    @relation(fields: [employeeId], references: [id])
}

model ActivityLog {
  id           String   @id @default(uuid())
  type         String
  employeeId   String
  employeeName String
  description  String
  metadata     Json?
  timestamp    DateTime @default(now())
  employee     Employee @relation(fields: [employeeId], references: [id])
}

enum Role {
  sales
  manager
}

enum CompanyGrade {
  A
  B
  C
}

enum CompanyStatus {
  existing
  lead
  inactive
  closed
  terminate
  active
}

enum LocationStatus {
  existing
  lead
  inactive
  closed
  terminate
  active
}

enum CustomerType {
  individual
  juristic
}

enum VatType {
  ex_vat  @map("ex-vat")
  in_vat  @map("in-vat")
  non_vat @map("non-vat")
}

enum LeaveType {
  sick
  personal
  vacation
  other
}

enum LeaveStatus {
  pending
  approved
  rejected
}

enum TaskStatus {
  pending
  in_progress
  completed
  overdue
}

enum TaskPriority {
  low
  medium
  high
}
